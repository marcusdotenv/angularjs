<!DOCTYPE html>
<html lang="en" ng-app="listaBomba">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
        integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <title>Cadastro de Bomba</title>
    <style>
        .jumbotron {
            width: 2000px;
            text-align: center;
            margin-top: 20px;
            margin-left: auto;
            margin-right: auto;
            background-color: #017E5C;
        }

        .list-item {
            color: #F2F2F2;

        }

        .negrito {
            font-weight: bold;
            color: #ffcf33;
        }

        .inputs-div {
            margin: 20px;
        }
        .buttons-div{
            height: 90px;
            justify-content: space-around;
            align-items: center;
            padding:auto;
       }
    </style>

    <script src="lib/angular/angular.js"></script>
    <script src="lib/angular/angular-messages.js"></script>
    <script>
        angular.module("listaBomba", ["ngMessages"]);
        angular.module("listaBomba").controller("listaBombaController", function ($scope, $http) {
            $scope.app = "Cadastro de Bomba";
            $scope.bombas = [];

            var carregarBomba = function () {
                $http.get("http://localhost:9595/api/bombas").then(sucessGET, errorGET)
            };
            function sucessGET(response) {
                $scope.bombas = response.data._embedded.bombas
            }
            function errorGET(error) {
                console.log(error)
            }
            $scope.adicionarBomba = function (bomba) {
                $http.post("http://localhost:9595/api/bombas", bomba).then(sucessPOST, errorPOST)
                delete $scope.bomba;
            };
            function sucessPOST(response) {
                carregarBomba();
                delete $scope.bomba;
            }
            function errorPOST(error) {
                console.log(error)
            }
            $scope.atualizarBombas = function (bombas, bomba) {
                $scope.bombas = bombas.filter(function (bomba2) {
                    if (bomba2.selecionado) {
                        $http.put(bomba2._links.bomba.href, bomba).then(sucessPOST, errorPOST)
                        carregarBomba();
                    }

                });
            };
            $scope.apagarBombas = function (bombas) {
                let arrayDelete = [];
                $scope.bombas = bombas.filter(function (bomba) {
                    if (bomba.selecionado) {
                        arrayDelete = [...arrayDelete, bomba]
                        arrayDelete.map(bomba2 => {
                            $http.delete(bomba2._links.bomba.href).then(sucessPOST, errorPOST)
                        })
                        carregarBomba();
                    };
                });
            };
            $scope.isBombaSelecionado = function (bombas) {
                return bombas.some(function (bomba) {
                    return bomba.selecionado;
                });
            };
            carregarBomba();
        });
    </script>
</head>

<body ng-controller="listaBombaController">
    <div class="jumbotron">
        <h3 class="list-item">{{app}}</h3>

        <table ng-show="bombas.length > 0" class="table table-striped mt-3">
            <tr>
                <th></th>
                <th class="list-item">Nome</th>
                <th class="list-item">Fabricante</th>
                <th class="list-item">Vazão Desejada</th>
                <th class="list-item">Range Vazão Min</th>
                <th class="list-item">Range Vazão Mínima</th>
                <th class="list-item">Vazão Nominal</th>
                <th class="list-item">Vazão Máxima</th>
                <th class="list-item">Coeficiente Head x0</th>
                <th class="list-item">Coeficiente Head x1</th>
                <th class="list-item">Coeficiente Head x2</th>
                <th class="list-item">Coeficiente Head x3</th>
                <th class="list-item">Coeficiente Head x4</th>
                <th class="list-item">Coeficiente Head x5</th>
                <th class="list-item">Coeficiente Potência x0</th>
                <th class="list-item">Coeficiente Potência x1</th>
                <th class="list-item">Coeficiente Potência x2</th>
                <th class="list-item">Coeficiente Potência x3</th>
                <th class="list-item">Coeficiente Potência x4</th>
                <th class="list-item">Coeficiente Potência x5</th>
            </tr>
            <tr ng-class="{'selecionado negrito': tempBomba.selecionado}" ng-repeat="tempBomba in bombas">
                <td><input type="checkbox" ng-model="tempBomba.selecionado" /></td>
                <td ng-class="{'list-item' : !tempBomba.selecionado}">{{tempBomba.nome}}</td>
                <td ng-class="{'list-item' : !tempBomba.selecionado}">{{tempBomba.fabricante}}</td>
                <td ng-class="{'list-item' : !tempBomba.selecionado}">{{tempBomba.vazaoDesejada}}</td>
                <td ng-class="{'list-item' : !tempBomba.selecionado}">{{tempBomba.rangeVazaoMin}}</td>
                <td ng-class="{'list-item' : !tempBomba.selecionado}">{{tempBomba.rangeVazaoMinima}}</td>
                <td ng-class="{'list-item' : !tempBomba.selecionado}">{{tempBomba.vazaoNominal}}</td>
                <td ng-class="{'list-item' : !tempBomba.selecionado}">{{tempBomba.vazaoMaxima}}</td>
                <td ng-class="{'list-item' : !tempBomba.selecionado}">{{tempBomba.curvaHeadX0}}</td>
                <td ng-class="{'list-item' : !tempBomba.selecionado}">{{tempBomba.curvaHeadX1}}</td>
                <td ng-class="{'list-item' : !tempBomba.selecionado}">{{tempBomba.curvaHeadX2}}</td>
                <td ng-class="{'list-item' : !tempBomba.selecionado}">{{tempBomba.curvaHeadX3}}</td>
                <td ng-class="{'list-item' : !tempBomba.selecionado}">{{tempBomba.curvaHeadX4}}</td>
                <td ng-class="{'list-item' : !tempBomba.selecionado}">{{tempBomba.curvaHeadX5}}</td>
                <td ng-class="{'list-item' : !tempBomba.selecionado}">{{tempBomba.curvaPotenciaX0}}</td>
                <td ng-class="{'list-item' : !tempBomba.selecionado}">{{tempBomba.curvaPotenciaX1}}</td>
                <td ng-class="{'list-item' : !tempBomba.selecionado}">{{tempBomba.curvaPotenciaX2}}</td>
                <td ng-class="{'list-item' : !tempBomba.selecionado}">{{tempBomba.curvaPotenciaX3}}</td>
                <td ng-class="{'list-item' : !tempBomba.selecionado}">{{tempBomba.curvaPotenciaX4}}</td>
                <td ng-class="{'list-item' : !tempBomba.selecionado}">{{tempBomba.curvaPotenciaX5}}</td>

            </tr>
        </table>
        <hr>

        <form class="form-inline inputs-div" name="bombaForm">
            <div class="form-inline">
                <input class="form-control mb-3" type="text" ng-model="bomba.nome" name="nome" placeholder="Nome"
                    ng-required="true" />
                <input class="form-control mb-3" type="text" ng-model="bomba.fabricante" name="fabricante"
                    placeholder="Fabricante" ng-required="true" />
                <input class="form-control mb-3" type="number" ng-model="bomba.vazaoDesejada" name="vazaoDesejada"
                    placeholder="Vazão Desejada" ng-required="true" />
            </div>
            <div class="form-inline">
                <input class="form-control mb-3" type="number" ng-model="bomba.rangeVazaoMin" name="rangeVazaoMin"
                    placeholder="Range Vazão Min" ng-required="true" />
                <input class="form-control mb-3" type="number" ng-model="bomba.rangeVazaoMinima" name="rangeVazaoMinima"
                    placeholder="Range Vazão Mínima" ng-required="true" />
                <input class="form-control mb-3" type="number" ng-model="bomba.vazaoNominal" name="vazaoNominal"
                    placeholder="Vazão nominal" ng-required="true" />
                <input class="form-control mb-3" type="number" ng-model="bomba.vazaoMaxima" name="vazaoMaxima"
                    placeholder="Vazão Máxima" ng-required="true" />
            </div>
            <div class="form-inline">
                <input class="form-control mb-3" type="number" ng-model="bomba.curvaHeadX0" name="curvaHeadX0"
                    placeholder="Coeficiente de Head x0" ng-required="true" />
                <input class="form-control mb-3" type="number" ng-model="bomba.curvaHeadX1" name="curvaHeadX1"
                    placeholder="Coeficiente de Head x1" ng-required="true" />
                <input class="form-control mb-3" type="number" ng-model="bomba.curvaHeadX2" name="curvaHeadX2"
                    placeholder="Coeficiente de Head x2" ng-required="true" />
                <input class="form-control mb-3" type="number" ng-model="bomba.curvaHeadX3" name="curvaHeadX3"
                    placeholder="Coeficiente de Head x3" ng-required="true" />
                <input class="form-control mb-3" type="number" ng-model="bomba.curvaHeadX4" name="curvaHeadX4"
                    placeholder="Coeficiente de Head x4" ng-required="true" />
                <input class="form-control mb-3" type="number" ng-model="bomba.curvaHeadX5" name="curvaHeadX5"
                    placeholder="Coeficiente de Head x5" ng-required="true" />
            </div>
            <div class="form-inline">
                <input class="form-control mb-3" type="number" ng-model="bomba.curvaPotenciaX0" name="curvaPotenciaX0"
                    placeholder="Coeficiente de Potência x0" ng-required="true" />
                <input class="form-control mb-3" type="number" ng-model="bomba.curvaPotenciaX1" name="curvaPotenciaX1"
                    placeholder="Coeficiente de Potência x1" ng-required="true" />
                <input class="form-control mb-3" type="number" ng-model="bomba.curvaPotenciaX2" name="curvaPotenciaX2"
                    placeholder="Coeficiente de Potência x2" ng-required="true" />
                <input class="form-control mb-3" type="number" ng-model="bomba.curvaPotenciaX3" name="curvaPotenciaX3"
                    placeholder="Coeficiente de Potência x3" ng-required="true" />
                <input class="form-control mb-3" type="number" ng-model="bomba.curvaPotenciaX4" name="curvaPotenciaX4"
                    placeholder="Coeficiente de Potência x4" ng-required="true" />
                <input class="form-control mb-3" type="number" ng-model="bomba.curvaPotenciaX5" name="curvaPotenciaX5"
                    placeholder="Coeficiente de Potência x5" ng-required="true" />
            </div>
        </form>

        <div ng-messages="bombaForm.$error" class="alert alert-danger mt-3">
            <div ng-message="required">
                Todos os campos devem ser preenchidos!
            </div>
        </div>
        <div class='buttons-div'>
            <button class="btn btn-primary btn-block" ng-click="adicionarBomba(bomba)" ng-if="!isBombaSelecionado(bombas)"
                ng-disabled="bombaForm.$invalid">Adicionar Bomba</button>
            <button class="btn btn-warning btn-block" ng-click="atualizarBombas(bombas, bomba)"
                ng-if="isBombaSelecionado(bombas)" ng-disabled="bombaForm.$invalid">Atualizar Bomba</button>
            <button class="btn btn-danger btn-block" ng-click="apagarBombas(bombas)"
                ng-if="isBombaSelecionado(bombas)">Apagar Bombas</button>
        </div>
    </div>
</body>

</html>